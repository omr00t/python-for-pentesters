FROM ubuntu:20.04

ENV TZ="Asia/Muscat"
ENV DEBIAN_FRONTEND="noninteractive"

RUN apt update
RUN apt install -y \
	git \
	php-cli \
	php-curl \
	php-xml \
	php-mysql \
	php-gd \
	unzip \
	curl \
	neovim \
	software-properties-common

RUN add-apt-repository ppa:deadsnakes/ppa -y
RUN apt install python3.10 -y
RUN ln -s /usr/bin/python3.10 /usr/bin/python

RUN curl -sS https://getcomposer.org/installer -o composer-setup.php
RUN php composer-setup.php --install-dir=/usr/local/bin --filename=composer

RUN mkdir /usr/src/app
WORKDIR /usr/src/app

ENV DB_CONNECTION="mysql"
ENV APP_TIMEZONE="Asia/Muscat"
ENV DB_HOST="172.16.238.51"
ENV DB_PORT="3306"
ENV DB_DATABASE="pcpapp"
ENV DB_USERNAME="pcpapp"
ENV DB_PASSWORD="pcppassword"

RUN git clone https://github.com/omr00t/PCPAPP .
RUN composer update --no-scripts
RUN cp .env.example .env
RUN php artisan key:generate
CMD bash -c "php artisan migrate && php artisan db:seed --force && php artisan serve --host 0.0.0.0 --port 80"
