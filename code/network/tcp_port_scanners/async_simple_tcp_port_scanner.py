import asyncio, sys
sem = asyncio.Semaphore(400)
async def tcp_scan(host, port):
    async with sem:
        try:
            conn = asyncio.open_connection(host, port)
            await asyncio.wait_for(conn, 1)
            print(f"{port}/tcp open")
        except (ConnectionRefusedError, asyncio.TimeoutError):
            pass
async def main():
    coros = [tcp_scan(sys.argv[1], port) for port in range(1, 65536)]
    await asyncio.gather(*coros)
asyncio.run(main())
