FROM ubuntu:20.04

ENV TZ="Asia/Muscat"
ENV DEBIAN_FRONTEND="noninteractive"

RUN apt update
RUN apt install -y \
	openssh-server \
	neovim \
	net-tools \
	iputils-ping \
	iptables \
	libpcap0.8-dev \
	netcat \ 
	binutils \
	software-properties-common

RUN add-apt-repository ppa:deadsnakes/ppa -y
RUN apt update
RUN apt install python3.10-full python3.10-dev -y
RUN ln -s /usr/bin/python3.10 /usr/bin/python
RUN python -m ensurepip --upgrade
RUN pip3.10 install pyftpdlib
RUN pip3.10 install scapy

RUN mkdir /ftp/
RUN echo "I'm a simple dummy file :)" > /ftp/dummy.txt


ENV FTP_PORT="21"
ENV FTP_USERNAME="ftpuser"
ENV FTP_PASSWORD="ftps3cr3tpassw0rd"
ENV FTP_DIRECTORY="/ftp/"

COPY ftp_server/ftp_server.py /root/



RUN mkdir /var/run/sshd

RUN echo 'root:s3cr3t' | chpasswd
RUN sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config
RUN sed 's@session\s*required\s*pam_loginuid.so@session optional pam_loginuid.so@g' -i /etc/pam.d/sshd

ENV NOTVISIBLE "in users profile"
RUN echo "export VISIBLE=now" >> /etc/profile

RUN useradd -d /home/khalid/ -m -s /bin/bash -U khalid
RUN echo "khalid:1337khalid" | chpasswd


COPY run.sh /root/
CMD ["bash", "/root/run.sh"]
